{
  "active": false,
  "connections": {
    "AI Agent": {
      "main": [
        [
          {
            "node": "Mandar mensaje",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Get Audio",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Image",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Get Audio": {
      "main": [
        [
          {
            "node": "Convertir Audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convertir Audio": {
      "main": [
        [
          {
            "node": "Transcribe a recording",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Transcribe a recording": {
      "main": [
        [
          {
            "node": "Audio Content",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Audio Content": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Audio Content1": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Image": {
      "main": [
        [
          {
            "node": "Convertir Imagen",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convertir Imagen": {
      "main": [
        [
          {
            "node": "Describe imagen",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Describe imagen": {
      "main": [
        [
          {
            "node": "Audio Content1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields2": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Normalizacion": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Normalizacion",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "IMAGENES": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "DB Propiedades": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "AGENTES": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "AGENDAR": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "UBICACION": {
      "ai_tool": [
        []
      ]
    },
    "AGENDAR CITA": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Webhook to Evolution API": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-11-21T01:09:03.660Z",
  "id": "h1TFgqXNC6h6G1KW",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Inmobiliaria Principal BKP",
  "nodes": [
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.chat_input }}",
        "options": {
          "systemMessage": "=D√≠a y hora actual: {{ $now }}\n\nEres un asistente inmobiliario en WhatsApp. Tu tarea es responder a leads interesados en propiedades y gestionar visitas usando exclusivamente las herramientas definidas.\n\nHerramientas disponibles\n\ndb.propiedades\nUso: buscar informaci√≥n de propiedades en la base de datos.\nCampos: ID, Tipo, Zona, Rec√°maras, Ba√±os, Metros¬≤, Precio, Amenidades, URL, Im√°genes, Ubicaci√≥n (maps_url).\nImportante: esta herramienta es la √∫nica fuente v√°lida de IDs y de la ubicaci√≥n. Nunca inventes ni adivines valores.\n\nimagenes\nUso: enviar fotos de una propiedad.\nRegla: cuando uses la herramienta imagenes, no devuelvas texto ni links en el reply; el flujo de la herramienta se encarga de enviar las fotos.\n\nAGENTES (Google Sheets)\nUso: verificar y decidir qu√© agente asignar.\nValidaciones:\n\nSolo elegir agentes con activo=TRUE.\n\nRevisar si el d√≠a y hora solicitados por el cliente caen dentro de sus dias_disponibilidad y horario_disponible.\n\nRound-robin: asignar al que tenga ultimo_asignado=FALSE. Si ambos coinciden, asignar al que no fue el √∫ltimo.\n\nAGENDAR (Google Calendar)\nUso: crear la cita en el calendario del agente elegido.\nInput: { agentId, calendarId, propertyId, lead:{nombre, telefono}, start, end }\nOutput: { eventId, status }\n\ncitas_agendadas (Google Sheets)\nUso: registrar y actualizar todas las citas.\nCampos obligatorios al registrar o modificar:\n\neventId (ID real de Google Calendar, nunca inventado)\n\npropertyId (de db.propiedades)\n\nagentId / agentName\n\ncliente_nombre\n\ncliente_telefono\n\nfecha, hora (start/end)\n\nstatus ‚Üí \"agendado\" o \"eliminado\" (escrito exactamente as√≠, sin variaciones).\n\nReglas de interacci√≥n\n\nPropiedades\n\nSi el usuario menciona un ID o zona, llama a db.propiedades y devuelve ficha con tipo, zona, precio, rec√°maras, ba√±os, metros¬≤, amenidades, link y ubicaci√≥n.\n\nSi el usuario da filtros (presupuesto, rec√°maras m√≠nimas, zona, amenidades), llama a db.propiedades con esos filtros. Devuelve 2‚Äì3 propiedades en lista con bullets y links. Si no hay match exacto, ofrece alternativas.\n\nFotos\n\nSi el usuario pide fotos, llama imagenes con el propertyId.\n\nNo agregues texto al reply; deja que la herramienta env√≠e las im√°genes.\n\nUbicaci√≥n\n\nSi el usuario pide direcci√≥n, ubicaci√≥n, ‚Äúd√≥nde queda‚Äù o ‚Äúm√°ndame la ubicaci√≥n‚Äù:\n\nUsa siempre el campo ubicacion de la propiedad en db.propiedades.\n\nDevuelve directamente el maps_url.\n\nNunca inventes ubicaciones ni direcciones.\n\nAgendar citas\n\nDespu√©s de mostrar propiedades, invita:\n‚Äú¬øQuieres que agendemos una visita? ¬øQu√© d√≠a y horario te acomoda en los pr√≥ximos d√≠as?‚Äù\n\nAntes de intentar agendar, aseg√∫rate de tener nombre y n√∫mero del cliente.\n\nSi no los tienes, pregunta:\n\n‚ÄúPerfecto, antes de confirmar la cita ¬øme compartes tu nombre completo y n√∫mero de celular?‚Äù\n\nCuando el cliente d√© nombre y n√∫mero ‚Üí guardar en memoria lead.nombre y lead.telefono.\n\nEl cliente da un d√≠a/hora o rango ‚Üí llamar AGENTES para validar disponibilidad.\n\nSi hay agente disponible ‚Üí asignar con round-robin.\n\nLlamar AGENDAR con el calendarId del agente y los datos del lead.\n\nAGENDAR devuelve eventId. Ese eventId es el ID oficial de la cita.\n\nRegistrar en citas_agendadas con:\n\neventId\n\npropertyId (de db.propiedades)\n\nagentId, agentName\n\ncliente_nombre, cliente_telefono\n\nfecha/hora (start, end)\n\nstatus = \"agendado\"\n\nResponder al cliente:\n‚ÄúPerfecto, tu visita qued√≥ confirmada para {fecha} a las {hora} con {Agente}. Si necesitas cancelar o reprogramar, av√≠same por este medio.‚Äù\n\nCancelar citas\n\nSi el cliente pide cancelar:\n\nIdentificar la cita por su eventId (o datos que permitan buscarla en citas_agendadas).\n\nActualizar en citas_agendadas el status a \"eliminado\".\n\nConfirmar al cliente:\n‚ÄúTu cita con {Agente} para {fecha} a las {hora} fue cancelada. Si deseas, podemos reprogramar otra fecha.‚Äù\n\nEjemplo conversacional\n\nUsuario: ‚ÄúQuiero agendar para el jueves a las 12.‚Äù\nAsistente: ‚ÄúCon gusto. Antes de confirmar, ¬øme compartes tu nombre completo y tu n√∫mero de celular?‚Äù\n\nUsuario: ‚ÄúSoy Juan P√©rez, mi n√∫mero es 5544332211.‚Äù\nAsistente: Llama db.propiedades con filtros ‚Üí obtiene propertyId=P010 y su ubicaci√≥n.\nLlama AGENTES (jueves 12:00) ‚Üí asigna agente.\nLuego llama AGENDAR con calendarId y lead.\nAGENDAR devuelve eventId=abc123.\nLuego registra en citas_agendadas con status=\"agendado\".\nAsistente: ‚ÄúPerfecto Juan, tu visita qued√≥ confirmada para jueves 12:00 con H√©ctor. Si necesitas cancelar o reprogramar, av√≠same por este medio.‚Äù\n\nUsuario: ‚ÄúMejor cancela mi cita.‚Äù\nAsistente: Busca eventId=abc123 en citas_agendadas y actualiza status=\"eliminado\".\nAsistente: ‚ÄúTu cita con H√©ctor para jueves 12:00 fue cancelada. Si quieres, puedo proponerte otra fecha.‚Äù"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        1328,
        16
      ],
      "id": "8e48fe03-ce88-421d-b845-06716ab28fbe",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o",
          "mode": "list",
          "cachedResultName": "gpt-4o"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        1328,
        -112
      ],
      "id": "8b5ef670-45ef-4db3-87ce-257c7eb72a55",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "aKfvNfQbjB1WCvlS",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message_content_type }}",
                    "rightValue": "audio",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "6571be58-7ae0-4b3a-9c4d-706d062d2428"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Audio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "98a252f3-df54-41c8-8d0f-705fee6eec87",
                    "leftValue": "={{ $json.message_content_type }}",
                    "rightValue": "image",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Imagen"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "ebf44caf-794d-434c-be9b-88adfc2d34a0",
                    "leftValue": "={{ $json.message_content_type }}",
                    "rightValue": "text",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Texto"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra",
          "renameFallbackOutput": "Otro"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -112,
        16
      ],
      "id": "536ca5ba-6022-422b-9016-3c59279549ff",
      "name": "Switch"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Normalizacion').item.json.instance_server_url }}/chat/getBase64FromMediaMessage/{{ $('Normalizacion').item.json.instance_name }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $('Normalizacion').item.json.instance_apikey }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "message.key.id",
              "value": "={{ $('Normalizacion').item.json.message_id }}"
            },
            {
              "name": "convertToMp4",
              "value": "={{ Boolean(false) }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        240,
        -176
      ],
      "id": "46b911bd-e508-4aff-b234-f08c50b90fe8",
      "name": "Get Audio"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "base64",
        "options": {
          "mimeType": "={{ $json.mimetype }}"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        400,
        -176
      ],
      "id": "b737918e-9615-466b-87d7-124228c0dab3",
      "name": "Convertir Audio"
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        592,
        -176
      ],
      "id": "324e4f61-5620-440a-92d9-2c661abf48e1",
      "name": "Transcribe a recording",
      "credentials": {
        "openAiApi": {
          "id": "aKfvNfQbjB1WCvlS",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "6e2644e1-fe2b-4523-b3bc-3db62622315c",
              "name": "content",
              "value": "={{ $json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        752,
        -176
      ],
      "id": "b8eb204f-39c1-4c8c-94ed-5be8d63d4dc6",
      "name": "Audio Content"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "6e2644e1-fe2b-4523-b3bc-3db62622315c",
              "name": "content",
              "value": "=<imagen>\n{{ $json.content}}\n</imagen>",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        752,
        16
      ],
      "id": "b29d0e7a-a42a-4b30-a0d7-e142d581868f",
      "name": "Audio Content1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Normalizacion').item.json.instance_server_url }}/chat/getBase64FromMediaMessage/{{ $('Normalizacion').item.json.instance_name }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $('Normalizacion').item.json.instance_apikey }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "message.key.id",
              "value": "={{ $('Normalizacion').item.json.message_id }}"
            },
            {
              "name": "convertToMp4",
              "value": "={{ Boolean(false) }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        240,
        16
      ],
      "id": "50a59a7f-012f-4013-86f2-49db10c173cf",
      "name": "Get Image"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "base64",
        "options": {
          "mimeType": "={{ $json.mimetype }}"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        400,
        16
      ],
      "id": "02d2c30d-1ae5-4d17-9513-b32a80d1e89f",
      "name": "Convertir Imagen"
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "gpt-4o",
          "mode": "list",
          "cachedResultName": "GPT-4O"
        },
        "text": "Describe la imagen",
        "inputType": "base64",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        592,
        16
      ],
      "id": "6a9a3627-6867-4fb9-99a2-e9b566c64fcb",
      "name": "Describe imagen",
      "credentials": {
        "openAiApi": {
          "id": "aKfvNfQbjB1WCvlS",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "6070e65d-c2d1-475e-af7c-c8ff0a5b059a",
              "name": "content",
              "value": "={{ $json.message_content }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        752,
        192
      ],
      "id": "9476cc05-7225-49d3-82ba-9445b4ecf243",
      "name": "Edit Fields2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "d56cc938-d653-4611-96fd-86d5eb56bf9c",
              "name": "chat_input",
              "value": "={{ $json.content }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1088,
        16
      ],
      "id": "95ba99af-e846-441e-84fa-a568a6b9600b",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "d9419665-41fc-43b9-aef7-d521a1ba2035",
              "name": "instance_server_url",
              "value": "={{ $json.body.server_url }}",
              "type": "string"
            },
            {
              "id": "c3cb8673-8006-4079-a304-c58ffc267226",
              "name": "instance_name",
              "value": "={{ $json.body.instance }}",
              "type": "string"
            },
            {
              "id": "e462da04-7f8b-4fbe-aacd-7956666c2ede",
              "name": "instance_apikey",
              "value": "={{ $json.body.apikey }}",
              "type": "string"
            },
            {
              "id": "b06da722-eea2-4f28-a2d4-7bcc6592b952",
              "name": "message_id",
              "value": "={{ $json.body.data.key.id }}",
              "type": "string"
            },
            {
              "id": "5ecbe629-f4d0-4bdf-8c78-903f311bc273",
              "name": "message_chat_id_sender",
              "value": "={{ $json.body.sender }}",
              "type": "string"
            },
            {
              "id": "cbb05e7c-4912-4965-bcf4-cefd9418b39f",
              "name": "message_content_type",
              "value": "={{ $json.body.data.message.extendedTextMessage ? 'text': '' }}{{ $json.body.data.message.conversation ? 'text': '' }}{{ $json.body.data.message.audioMessage ? 'audio': '' }}{{ $json.body.data.message.imageMessage ? 'image': '' }}",
              "type": "string"
            },
            {
              "id": "d6fa8877-dee6-468b-a51e-8fdc36dc190f",
              "name": "message_content",
              "value": "={{ $json.body.data.message.extendedTextMessage?.text || '' }} {{ $json.body.data.message.imageMessage?.caption || '' }} {{ $json.body.data.message.conversation || '' }}",
              "type": "string"
            },
            {
              "id": "f122b51f-8a93-439e-85fb-c370e7f4f6b8",
              "name": "message_timestamp",
              "value": "={{ $json.body.date_time }}",
              "type": "string"
            },
            {
              "id": "e10a7e61-cffe-44fb-9b13-e0c199ebd866",
              "name": "user_name",
              "value": "={{ $json.body.data.pushName }}",
              "type": "string"
            },
            {
              "id": "1c280646-7eb8-4118-9e8d-432f04a763b7",
              "name": "user_number",
              "value": "={{ $json.body.data.key.remoteJid }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -288,
        48
      ],
      "id": "a855d721-493d-49c2-8eeb-ad6180c99f6e",
      "name": "Normalizacion"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Normalizacion').item.json.instance_server_url }}/message/sendText/{{ $('Normalizacion').item.json.instance_name }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $('Normalizacion').item.json.instance_apikey }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $('Normalizacion').item.json.user_number }}"
            },
            {
              "name": "text",
              "value": "={{ $json.output }}"
            },
            {
              "name": "delay",
              "value": "={{ 1000 }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1744,
        16
      ],
      "id": "0c5cc843-3276-4254-972e-bdd031b40072",
      "name": "Mandar mensaje"
    },
    {
      "parameters": {
        "amount": 1,
        "path": "aefd52e4-7734-4e57-b602-96419e17bcf3"
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -576,
        48
      ],
      "id": "641c2116-966c-49a3-ba51-dae851fe8772",
      "name": "Wait",
      "webhookId": "aefd52e4-7734-4e57-b602-96419e17bcf3"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Normalizacion').item.json.user_number }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        1440,
        -112
      ],
      "id": "9ee79bd2-1643-4418-b76f-d233ffc35a4b",
      "name": "Postgres Chat Memory",
      "credentials": {
        "postgres": {
          "id": "9iRvr6cD7drCbVTk",
          "name": "Postgres Supabase Credentials"
        }
      }
    },
    {
      "parameters": {
        "description": "=Nombre: fotos\nDescripci√≥n: Manda fotos de la propiedad al usuario\n\nC√≥mo activarla:\n- Si el usuario pide fotos o im√°genes de un inmueble, llama a esta herramienta.\n- Usa el `Id` si est√° disponible (ej. \"P012\").\n- Si no se menciona ID, usa filtros de b√∫squeda (zona, presupuesto, rec√°maras) para elegir el inmueble m√°s probable.\n",
        "workflowId": {
          "__rl": true,
          "value": "2K2cjhpRMSAKa7Xu",
          "mode": "list",
          "cachedResultUrl": "/workflow/2K2cjhpRMSAKa7Xu",
          "cachedResultName": "Inmobiliaria Imagenes"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('id', `El ID, de la propiedad la cual el usuario quiere obtener im√°genes`, 'string') }}",
            "numero": "={{ $('Normalizacion').item.json.user_number }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "numero",
              "displayName": "numero",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        1856,
        320
      ],
      "id": "791b765d-def2-4fa2-a763-582344554bc6",
      "name": "IMAGENES"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1cGPzbXAtcbcN5iuYZuyjXEf2iqgVOP38AD2Cg9gkjl8",
          "mode": "list",
          "cachedResultName": "INMOBILIARIA DDBB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1cGPzbXAtcbcN5iuYZuyjXEf2iqgVOP38AD2Cg9gkjl8/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Propiedades",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1cGPzbXAtcbcN5iuYZuyjXEf2iqgVOP38AD2Cg9gkjl8/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.7,
      "position": [
        1552,
        304
      ],
      "id": "f903f450-73dd-404e-b932-ba26c2084923",
      "name": "DB Propiedades",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "UgE1zX4Tu6qFLtP2",
          "name": "Google Sheets GB account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Utiliza esta herramienta para acceder a la db de los agentes de la inmobiliaria",
        "documentId": {
          "__rl": true,
          "value": "1cGPzbXAtcbcN5iuYZuyjXEf2iqgVOP38AD2Cg9gkjl8",
          "mode": "list",
          "cachedResultName": "INMOBILIARIA DDBB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1cGPzbXAtcbcN5iuYZuyjXEf2iqgVOP38AD2Cg9gkjl8/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 809038144,
          "mode": "list",
          "cachedResultName": "Ejecutivos de ventas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1cGPzbXAtcbcN5iuYZuyjXEf2iqgVOP38AD2Cg9gkjl8/edit#gid=809038144"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.7,
      "position": [
        1312,
        304
      ],
      "id": "0a9b1fb0-e65f-4f44-a50d-37ddffc64517",
      "name": "AGENTES",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "UgE1zX4Tu6qFLtP2",
          "name": "Google Sheets GB account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Utiiza esta herramienta para agendar las citas",
        "calendar": {
          "__rl": true,
          "mode": "id",
          "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Calendar', ``, 'string') }}",
          "__regex": "(^[a-zA-Z0-9.!#$%&‚Äô*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*)"
        },
        "useDefaultReminders": false,
        "additionalFields": {
          "description": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Description', ``, 'string') }}",
          "summary": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Summary', ``, 'string') }}"
        }
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [
        1168,
        304
      ],
      "id": "d2f60861-c1f1-40bc-a8db-412f59ce2b2e",
      "name": "AGENDAR",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "QM6it0rPeasJ1pJO",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "description": "Utiliza esta herramienta cuando tengas que mandar la ubicacion de la propiedad al usuario",
        "workflowId": {
          "__rl": true,
          "value": "vIyDWKEmEFsErT9M",
          "mode": "list",
          "cachedResultName": "Inmobiliaria / Ubicacion"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "id_propiedad": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('id_propiedad', `Manda el id de la propiedad`, 'number') }}"
          },
          "matchingColumns": [
            "id_propiedad"
          ],
          "schema": [
            {
              "id": "id_propiedad",
              "displayName": "id_propiedad",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "number",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        1728,
        320
      ],
      "id": "2b22208a-f0c4-4856-8706-065a324544c5",
      "name": "UBICACION"
    },
    {
      "parameters": {
        "content": "## Automatizaci√≥n para Inmobiliarias\n# [Guide](https://www.skool.com/rubin-automatizaciones-ia-n8n-9701/robame-esta-automatizacion-para-inmobiliarias-3000usd-n8n-paso-a-paso)\n\nhttps://youtu.be/tULVMrIvWSg",
        "height": 176,
        "width": 448
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -416,
        -336
      ],
      "typeVersion": 1,
      "id": "ff0d91da-509f-4ec7-959d-ea18c73753cb",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1cGPzbXAtcbcN5iuYZuyjXEf2iqgVOP38AD2Cg9gkjl8",
          "mode": "list",
          "cachedResultName": "INMOBILIARIA DDBB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1cGPzbXAtcbcN5iuYZuyjXEf2iqgVOP38AD2Cg9gkjl8/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1615782114,
          "mode": "list",
          "cachedResultName": "Reg. Citas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1cGPzbXAtcbcN5iuYZuyjXEf2iqgVOP38AD2Cg9gkjl8/edit#gid=1615782114"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "ID_CITA ",
              "displayName": "ID_CITA ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Nombre_Cliente",
              "displayName": "Nombre_Cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Numero_Cliente ",
              "displayName": "Numero_Cliente ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "ID_Propiedad",
              "displayName": "ID_Propiedad",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Nombre_Propiedad",
              "displayName": "Nombre_Propiedad",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Nombre_Ejecutivo",
              "displayName": "Nombre_Ejecutivo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "ID_ejecutivo",
              "displayName": "ID_ejecutivo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Horario y D√≠a ",
              "displayName": "Horario y D√≠a ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Estatus",
              "displayName": "Estatus",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Execution_ID",
              "displayName": "Execution_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.7,
      "position": [
        1424,
        304
      ],
      "id": "e33770b3-d9a5-4653-9372-02656e4519b0",
      "name": "AGENDAR CITA",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "UgE1zX4Tu6qFLtP2",
          "name": "Google Sheets GB account"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "6d348089-10b3-4d67-845d-95744934888d",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -784,
        48
      ],
      "id": "22cdcaf7-0570-4ab0-9790-86fbe0f32a50",
      "name": "Webhook to Evolution API",
      "webhookId": "6d348089-10b3-4d67-845d-95744934888d"
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "updatedAt": "2025-11-21T01:09:03.667Z",
      "createdAt": "2025-11-21T01:09:03.667Z",
      "role": "workflow:owner",
      "workflowId": "h1TFgqXNC6h6G1KW",
      "projectId": "epI1cymQzCzDlQMH"
    }
  ],
  "staticData": null,
  "tags": [
    {
      "updatedAt": "2025-11-19T22:36:45.524Z",
      "createdAt": "2025-11-19T22:36:45.524Z",
      "id": "oOBV7K2KRexZs41J",
      "name": "üü† Rubin Autom. AI"
    }
  ],
  "triggerCount": 0,
  "updatedAt": "2025-11-21T01:09:03.000Z",
  "versionId": "5830cb7a-9281-4c86-a17e-43fe27918b0a"
}